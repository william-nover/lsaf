<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Content_promo extends CI_Controller {	public $arrMenu = array();	public $data;	public $privilege = array();	public $section = 3; //get module group id from database	public $module_id = 40; //get module id from database	public $alias_category = "Content_promo";	public $module = "Content_promo";		public function __construct()	{		parent::__construct();                session_start();		if(empty($_SESSION['admin_data'])){			session_destroy();			redirect(BASE_URL_BACKEND."/signin");			exit();		}				$this->load->model(array('backend/Model_alias', 'backend/Model_language','backend/Model_logcms'));		$this->load->helper(array('funcglobal','menu','accessprivilege','alias'));				//get menu from helper menu		$this->arrMenu = menu();		$this->data = array();                $this->data['ListMenu'] = $this->arrMenu;                 $this->data['CountMenu'] = count($this->arrMenu);				//check privilege module		$this->privilege = accessprivilegeuserlevel($_SESSION['admin_data']['user_level_id'], $this->module_id);		$this->breadcrump = breadCrump($this->module_id);	}		public function index()	{		$this->add();	}				public function add(){		//extract privilege		$this->data["add"] = $this->privilege[2];		$this->data["approve"] = $this->privilege[5];		if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}				$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		                $pathOverview = PATH_ASSETS."/json/content_promo.json";                if ($pathOverview){                        $arrOverview = json_decode(file_get_contents($pathOverview),TRUE);                        $this->data['promo_title'] = $arrOverview['promo_title'];                        $this->data['promo_image'] =  $arrOverview['promo_image'];                        $this->data['promo_desc'] =  $arrOverview['promo_desc'];                        $this->data['promo_link'] =  $arrOverview['promo_link'];                        $this->data['status'] =  $arrOverview['status'];                }               		$this->load->view('backend/header',$this->data);		$this->load->view('backend/content_promo/list',$this->data);	}		public function doAdd(){		//extract privilege		$this->data["add"] = $this->privilege[2];                $this->data["approve"] = $this->privilege[5];				if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}				$tb = $_POST['tbSave'];		if (!$tb) {			redirect(BASE_URL_BACKEND."/content_promo");			exit();		}				$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;                $promo_title = $this->security->xss_clean(secure_input($_POST['promo_title']));                $promo_image = $this->security->xss_clean(secure_input($_POST['promo_imageurl']));		$promo_desc = $this->security->xss_clean(secure_input($_POST['promo_desc']));                $promo_link = $this->security->xss_clean(secure_input($_POST['promo_link']));                $promo_status =  secure_input_editor($_POST['promo_status']);                if ($promo_status == 1){                    $pstatus = 1;                                        }                 else {                    $pstatus = 0;                    }		if ($_SESSION['admin_data']['user_level_id'] == 1){                    $status = $pstatus;                } else {                     $status = 0;                }		$pesan = array();		// Validasi data		if ($promo_title=="") {			$pesan[] = 'Promo title empty';		} else if ($promo_desc=="") {			$pesan[] = 'Promo title is empty';		}				if (! count($pesan)==0 ) {			foreach ($pesan as $indeks=>$pesan_tampil) {				$this->data['error'] = $pesan_tampil;				$this->data['promo_title']=$promo_title;                                $this->data['promo_image']=$promo_image;				$this->data['promo_desc']=$promo_desc;                                $this->data['promo_link']=$promo_link;				$this->data['status']=$status;									$this->load->view('backend/header',$this->data);				$this->load->view('backend/content_promo/list',$this->data);			}		} else {                    $promo_imageurl = str_replace(BASE_URL,"",$promo_image);                     $data = array(                                              'promo_title' => $promo_title,                                          'promo_image' => $promo_imageurl,                                          'promo_desc' => $promo_desc,                                          'promo_link' => $promo_link,                                          'status' => $status                                           );                     print_r($data);                                    $ListContent_promo= $data;                    createCache($ListContent_promo,"content_promo");                    $log_module = "Add ".$this->module;                    $log_value = "Overview | ".$promo_title." | ".$promo_desc." | ".$status;                    $insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                            if ($_SESSION['admin_data']['user_level_id'] != 1){                                     $log ='Edit';                                     $controller='Home Management Section 2';                                     $this->sendmailnotif($promo_title,$controller,$log);                                }                     redirect(BASE_URL_BACKEND."/content_promo/");                }		}	function sendmailnotif($content_title, $controller, $log)              {            //  $this->load->library('email');                         $subject = $log .'Banner Log';                        $message_email = "Some one has been edit, <br><br>";                        $message_email .= "Title : ".$content_title."<br>";                        $message_email .= "Page : ".$controller."<br>";			$header = "";			$header .= "Reply-To: ".BASE_URL." <noreply@".$_SERVER['SERVER_NAME'].">\r\n";			$header .= "Return-Path: ".BASE_URL." <noreply@".$_SERVER['SERVER_NAME'].">\r\n";			$header .= "From: ".BASE_URL." <noreply@".$_SERVER['SERVER_NAME'].">\r\n";			$header .= "Organization: ".$_SERVER['SERVER_NAME']." \r\n";			$header .= "X-Priority: 3\r\n";			$header .= "MIME-Version: 1.0\r\n";			$header .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";                                                     // Insert user record                      mail(MAIL_ADMINISTRATOR, $subject, $message_email, $header);                   // mail("hl.prbadolsa@gmail.com", $subject, $message_email, $header);              }		}