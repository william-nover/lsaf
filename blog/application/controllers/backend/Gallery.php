<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Category extends CI_Controller {	public $arrMenu = array();	public $data;	public $privilege = array();	public function __construct()	{		parent::__construct();                if( ! $_SESSION)                {                    session_start();                }		if(empty($_SESSION['admin_data'])){			session_destroy();			redirect(BASE_URL_BACKEND."/signin");			exit();		}		$this->load->model(array('backend/Model_menu_frontend','backend/Model_gallery','backend/Model_list_gallery','backend/Model_alias', 'backend/Model_language','backend/Model_logcms'));		$this->load->helper(array('funcglobal','menu','accessprivilege','alias'));		                $module_name=  $this->uri->segment(2);                $getmodule = $this->Model_gallery->getModule($module_name);                foreach ($getmodule as $gm) {                 $this->module_id = $gm->module_id;                 $this->section = $gm->module_group_id;                 $_SESSION['module_id']=$this->module_id;                }		//get menu from helper menu		$this->arrMenu = menu();		$this->data = array();                $this->data['ListMenu'] = $this->arrMenu;                $this->data['CountMenu'] = count($this->arrMenu);		$this->data['controller'] = $module_name;                               $this->data['allModule'] = $this->Model_gallery->getModuleAll();		//check privilege module		$this->privilege = accessprivilegeuserlevel($_SESSION['admin_data']['user_level_id'], $_SESSION['module_id']);		$this->breadcrump = breadCrump($_SESSION['module_id']);	}	public function index()	{		$this->view();	}		function view(){		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $_SESSION['module_id'];		$this->data['breadcrump'] = $this->breadcrump;		$searchkey = "";		$searchby = "";                                $condp = "order by b.module_group_id , a.gallery_order Asc ";                $ListCategory = $this->Model_gallery->getListCategory($condp);			$this->data["ListCategory"] = $ListCategory;		//extract privilege		$this->data["list"] = $this->privilege[0];		$this->data["view"] = $this->privilege[1];		$this->data["add"] = $this->privilege[2];		$this->data["edit"] = $this->privilege[3];		$this->data["publish"] = $this->privilege[4];		$this->data["approve"] = $this->privilege[5];		$this->data["delete"] = $this->privilege[6];		$this->data["order"] = $this->privilege[7];		if($this->data["list"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}				$this->data['searchkey'] = $searchkey;		$this->data['searchby'] = $searchby;				$this->load->view('backend/header',$this->data);		$this->load->view('backend/gallery/list');	}         function add(){		//extract privilege		$this->data["add"] = $this->privilege[2];		if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		                              		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;               		$this->load->view('backend/header',$this->data);		$this->load->view('backend/gallery/add',$this->data);	}      	public function doAdd(){		//extract privilege		$this->data["add"] = $this->privilege[2];		if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$tb = $_POST['tbSave'];		if (!$tb) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$gallery_title = $this->security->xss_clean(secure_input($_POST['gallery_title']));     		$module_id = $this->security->xss_clean(secure_input($_POST['module_id']));		$pesan = array();		// Validasi data		if ($gallery_title=="") {			$pesan[] = 'Category Page Title is empty';		} 			if (! count($pesan)==0 ) {			foreach ($pesan as $indeks=>$pesan_tampil) {				$this->data['error'] = $pesan_tampil;								$this->data['gallery_title']=$gallery_title;													$this->load->view('backend/header',$this->data);				$this->load->view('backend/gallery/addpages',$this->data);			}		} else {			$cekCategory = $this->Model_gallery->checkCategory($gallery_title);			$countCategory = count($cekCategory);						if ($countCategory > 0 ) {				$this->data['error']='Category Title '.$gallery_title.' already exist';				$this->data['gallery_title']=$gallery_title;							$this->load->view('backend/header',$this->data);				$this->load->view('backend/gallery/add',$this->data);			} else {				$gallery_id = $this->Model_gallery->insertCategory($gallery_title,$module_id);                                                               $log_module = "Add ".$this->module;                                $log_value = $gallery_id." | ".$gallery_title;                                $insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);				                                redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);				}			}		}   	function active($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["approve"] = $this->privilege[5];		if($this->data["approve"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsCategory = $this->Model_gallery->getCategory($id); 		$title = $rsCategory[0]['gallery_title'];		$active_status = abs($rsCategory[0]['gallery_active_status']-1);		$active = $this->Model_gallery->activeCategory($id);		createRouteAlias(); //create route alias		if($active_status == 1){			$log_module = "Active ".$this->module;		} else {			$log_module = "Inactive ".$this->module;		}		$log_value = $id." | ".$title." | ".$active_status;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                                //$this->generateCategory();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);	}         function delete($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];				if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsCategory = $this->Model_gallery->getCategory($id); 		$title = $rsCategory[0]['gallery_title'];                       $page_type = $rsCategory[0]['page_type'];                if($page_type == 2){                $this->deleteCategory($id);                }                $delete = $this->Model_gallery->deleteCategory($id);		$log_module = "Delete ".$this->module;		$log_value = $id." | ".$title;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                                //$this->generateCategory();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);	}              public function deleteCategory($id){            if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];		if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}                $where = "";                $orderBy = "ORDER BY a.gallery_id DESC";				$cond 			= $where." ".$orderBy;                $ListCategory = $this->Model_gallery->getListCategory($id, $cond);                foreach($ListCategory as $gallery){                          $image_path = './assets/images/'.$gallery['gallery_image'];                         $image_resize = './assets/images/resized/'.$gallery['gallery_image'];                                 $image_thumb = './assets/images/thumb/'.$gallery['gallery_image'];                         if($gallery['gallery_image'] != 'default_icon.png'){                        unlink($image_path);                        unlink($image_resize);                        unlink($image_thumb);                           }                             $this->Model_gallery->deleteCategory($gallery['gallery_id']);                }                           }      public function edit($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["edit"] = $this->privilege[3];		if($this->data["edit"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;			$rsCategory = $this->Model_gallery->getCategory($id);                 // mengambil database dari model untuk dikirim ke view		                $countCategory = count($rsCategory);		$this->data['rsCategory'] = $rsCategory;		$this->data['countCategory'] = $countCategory;		$this->load->view('backend/header',$this->data);		$this->load->view('backend/gallery/edit',$this->data);	}		public function doEdit($id){		$tb = $_POST['tbEdit'];		if (!$tb OR $id == '') {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["edit"] = $this->privilege[3];		if($this->data["edit"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$rsCategory = $this->Model_gallery->getCategory($id);  // mengambil database dari model untuk dikirim ke view		$countCategory = count($rsCategory);		$this->data['rsCategory'] = $rsCategory;		$this->data['countCategory'] = $countCategory;		$gallery_title = $this->security->xss_clean(secure_input($_POST['gallery_title']));                $module_id = $this->security->xss_clean(secure_input($_POST['module_id']));				$pesan = array();		// Validasi data		if ($gallery_title=="") {			$pesan[] = 'Category Title is empty';		} 		if (! count($pesan)==0 ) {			foreach ($pesan as $indeks=>$pesan_tampil) {				$this->data['error'] = $pesan_tampil;				$this->load->view('backend/header',$this->data);				$this->load->view('backend/gallery/edit',$this->data);			}		} else {                    $update = $this->Model_gallery->updateCategory($id,$gallery_title,$module_id);				                                $log_module = "Edit ".$this->module;                                $log_value = $id." | ".$gallery_title;                                $insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                                                                //$this->generateCategory();                                                                                            redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);}			}                 function doOrder(){		$order = $this->security->xss_clean($_POST['order']);		if($order == ""){			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}         foreach($order as $id => $ordervalue){			$this->Model_gallery->updateOrderCategory($id,$ordervalue);                        echo $ordervalue;		}                //$this->generateCategory();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);	}        function listCategory($gallery_id=NULL){                                $_SESSION['gallery_id'] = $gallery_id;                $admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$searchkey = "";		$searchby = "";		$where = "";		$orderBy = "";		$perpage = "";			$cond = " and a.gallery_type = 2 ORDER BY a.list_gallery_id ASC";		$ListCategory = $this->Model_list_gallery->getListCategory($gallery_id, $cond);////		print_r($ListCategory);//                die;		$this->data["ListCategory"] = $ListCategory;		//extract privilege		$this->data["list"] = $this->privilege[0];		$this->data["view"] = $this->privilege[1];		$this->data["add"] = $this->privilege[2];		$this->data["edit"] = $this->privilege[3];		$this->data["publish"] = $this->privilege[4];		$this->data["approve"] = $this->privilege[5];		$this->data["delete"] = $this->privilege[6];		$this->data["order"] = $this->privilege[7];		if($this->data["list"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$this->data['searchkey'] = $searchkey;		$this->data['searchby'] = $searchby;		$this->data['perpage'] = $perpage;		$this->load->view('backend/header',$this->data);		$this->load->view('backend/list_gallery/list');	}              function insertCategory() {          $gallery_id = $_SESSION['gallery_id'];        $today= date("Y-m-d H:i:s");            $data = array();              for ($i = 0; $i < count($this->input->post('subpage_title')); $i++) {                 $resize=$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]));                 $thumbnail=$this->resizing($resize);                 $data[] = array(                      'gallery_id'=>$gallery_id,                      'gallery_type'=>$this->security->xss_clean(secure_input($_POST['gallery_type'])),                      'list_gallery_title' => $this->security->xss_clean(secure_input($_POST['subpage_title'][$i])),                      'list_gallery_image' =>  str_replace(BASE_URL,"",$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]))),                       'list_gallery_url' => '',                       'list_gallery_active_status'=>0,                      'list_gallery_order'=>($i+1),                      'list_gallery_create_date'=>$today,                      'list_gallery_create_by'=>$_SESSION['admin_data']['user_id'],                      'list_gallery_update_date'=>'',                      'list_gallery_update_by'=>''                  );              }         $this->Model_list_gallery->insertListCategory($data);         $this->data['errors'] = $this->error;         $this->data['success'] = $this->success;        //$this->generateCategory();        redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/listCategory/'.$gallery_id);    }            function editListCategory(){            $list_gallery_id = $this->input->post('primary_key');            $list_gallery_title = $this->input->post('title');             $list_gallery_image = str_replace(BASE_URL,"",$this->input->post('imgurl'));            $list_gallery_status=$this->input->post('status');             $list_gallery_url = '';            $resize =$this->input->post('imgurl');            $thumbnail=$this->resizing($resize);            $list_gallery_order = $this->input->post('order');            if ($_SESSION['admin_data']['user_level_id'] == 1){                    $list_gallery_status = $list_gallery_status;                } else {                     $list_gallery_status = 0;                }            $this->Model_list_gallery->editListCategory($list_gallery_title,$list_gallery_image,$list_gallery_url,$list_gallery_order,$list_gallery_status,$list_gallery_id);            //$this->generateCategory();                       redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListCategory/'.$_SESSION['gallery_id']);    }           function activeListCategory($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListCategory/'.$_SESSION['gallery_id']);			exit();		}			//extract privilege		$this->data["approve"] = $this->privilege[5];				if($this->data["approve"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsContent = $this->Model_list_gallery->getListCategoryBy($id); 		$title = $rsContent[0]['list_gallery_title'];		$active_status = abs($rsContent[0]['list_gallery_active_status']-1);		$active = $this->Model_list_gallery->activeListCategory($id);		//createRouteAlias(); //create route alias		if($active_status == 1){			$log_module = "Active ".$this->module;		} else {			$log_module = "Inactive ".$this->module;		}		$log_value = $id." | ".$title." | ".$active_status;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);		//$this->generateCategory();                redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListCategory/'.$_SESSION['gallery_id']);			}         function deleteListCategoryBy($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListCategory/'.$_SESSION['gallery_id']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];		if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}       		$delete = $this->Model_list_gallery->deleteListCategoryby($id);		$log_module = "Delete ".$this->module;		$log_value = $id." | ".$title;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                //$this->generateCategory();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListCategory/'.$_SESSION['gallery_id']);	}       function generateCategory(){                $ListCategory		= $this->Model_list_gallery->generateCategory();		$countCategory		= count($ListCategory);		//createCacheBanner($rsBanner,"bannerhome");               createCache($ListCategory,"gallery");        }                       function listSwf($gallery_id=NULL){                                $_SESSION['gallery_id'] = $gallery_id;                $admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$searchkey = "";		$searchby = "";		$where = "";		$orderBy = "";		$perpage = "";			$cond = " and a.gallery_type = 1 ORDER BY a.list_gallery_id ASC";		$ListCategory = $this->Model_list_gallery->getListCategory($gallery_id, $cond);////		print_r($ListCategory);//                die;		$this->data["ListCategory"] = $ListCategory;		//extract privilege		$this->data["list"] = $this->privilege[0];		$this->data["view"] = $this->privilege[1];		$this->data["add"] = $this->privilege[2];		$this->data["edit"] = $this->privilege[3];		$this->data["publish"] = $this->privilege[4];		$this->data["approve"] = $this->privilege[5];		$this->data["delete"] = $this->privilege[6];		$this->data["order"] = $this->privilege[7];		if($this->data["list"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$this->data['searchkey'] = $searchkey;		$this->data['searchby'] = $searchby;		$this->data['perpage'] = $perpage;		$this->load->view('backend/header',$this->data);		$this->load->view('backend/list_swf/list');	}                            function insertSwf() {          $gallery_id = $_SESSION['gallery_id'];        $today= date("Y-m-d H:i:s");            $data = array();              for ($i = 0; $i < count($this->input->post('subpage_title')); $i++) {                 $resize=$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]));                 $thumbnail=$this->resizing($resize);                 $data[] = array(                      'gallery_id'=>$gallery_id,                      'gallery_type'=>$this->security->xss_clean(secure_input($_POST['gallery_type'])),                      'list_gallery_title' => $this->security->xss_clean(secure_input($_POST['subpage_title'][$i])),                      'list_gallery_image' =>  str_replace(BASE_URL,"",$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]))),                        'list_gallery_url' => $this->security->xss_clean(secure_input($_POST['subpage_url'][$i])),                        'list_gallery_active_status'=>0,                      'list_gallery_order'=>($i+1),                      'list_gallery_create_date'=>$today,                      'list_gallery_create_by'=>$_SESSION['admin_data']['user_id'],                      'list_gallery_update_date'=>'',                      'list_gallery_update_by'=>''                  );              }         $this->Model_list_gallery->insertListCategory($data);         $this->data['errors'] = $this->error;         $this->data['success'] = $this->success;        //$this->generateCategory();        redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/listSwf/'.$gallery_id);    }            function editListSwf(){            $list_gallery_id = $this->input->post('primary_key');            $list_gallery_title = $this->input->post('title');             $list_gallery_image = str_replace(BASE_URL,"",$this->input->post('imgurl'));            $list_gallery_url = str_replace(BASE_URL,"",$this->input->post('vidurl'));            $list_gallery_status=$this->input->post('status');             $resize =$this->input->post('imgurl');            $thumbnail=$this->resizing($resize);            $list_gallery_order = $this->input->post('order');            if ($_SESSION['admin_data']['user_level_id'] == 1){                    $list_gallery_status = $list_gallery_status;                } else {                     $list_gallery_status = 0;                }            $this->Model_list_gallery->editListCategory($list_gallery_title,$list_gallery_image,$list_gallery_url,$list_gallery_order,$list_gallery_status,$list_gallery_id);            //$this->generateCategory();                       redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListSwf/'.$_SESSION['gallery_id']);    }           function activeListSwf($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListSwf/'.$_SESSION['gallery_id']);			exit();		}			//extract privilege		$this->data["approve"] = $this->privilege[5];				if($this->data["approve"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsContent = $this->Model_list_gallery->getListCategoryBy($id); 		$title = $rsContent[0]['list_gallery_title'];		$active_status = abs($rsContent[0]['list_gallery_active_status']-1);		$active = $this->Model_list_gallery->activeListCategory($id);		//createRouteAlias(); //create route alias		if($active_status == 1){			$log_module = "Active ".$this->module;		} else {			$log_module = "Inactive ".$this->module;		}		$log_value = $id." | ".$title." | ".$active_status;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);		//$this->generateCategory();                redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListSwf/'.$_SESSION['gallery_id']);			}         function deleteListSwfBy($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListSwf/'.$_SESSION['gallery_id']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];		if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}       		$delete = $this->Model_list_gallery->deleteListCategoryby($id);		$log_module = "Delete ".$this->module;		$log_value = $id." | ".$title;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                //$this->generateCategory();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListSwf/'.$_SESSION['gallery_id']);	}                     function listVideo($gallery_id=NULL){                                $_SESSION['gallery_id'] = $gallery_id;                $admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$searchkey = "";		$searchby = "";		$where = "";		$orderBy = "";		$perpage = "";			$cond = " and a.gallery_type = 3 ORDER BY a.list_gallery_id ASC";		$ListCategory = $this->Model_list_gallery->getListCategory($gallery_id, $cond);////		print_r($ListCategory);//                die;		$this->data["ListCategory"] = $ListCategory;		//extract privilege		$this->data["list"] = $this->privilege[0];		$this->data["view"] = $this->privilege[1];		$this->data["add"] = $this->privilege[2];		$this->data["edit"] = $this->privilege[3];		$this->data["publish"] = $this->privilege[4];		$this->data["approve"] = $this->privilege[5];		$this->data["delete"] = $this->privilege[6];		$this->data["order"] = $this->privilege[7];		if($this->data["list"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$this->data['searchkey'] = $searchkey;		$this->data['searchby'] = $searchby;		$this->data['perpage'] = $perpage;		$this->load->view('backend/header',$this->data);		$this->load->view('backend/list_video/list');	}                            function insertVideo() {          $gallery_id = $_SESSION['gallery_id'];        $today= date("Y-m-d H:i:s");            $data = array();              for ($i = 0; $i < count($this->input->post('subpage_title')); $i++) {                 $resize=$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]));                 $thumbnail=$this->resizing($resize);                 $data[] = array(                      'gallery_id'=>$gallery_id,                      'gallery_type'=>$this->security->xss_clean(secure_input($_POST['gallery_type'])),                      'list_gallery_title' => $this->security->xss_clean(secure_input($_POST['subpage_title'][$i])),                      'list_gallery_image' =>  str_replace(BASE_URL,"",$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]))),                        'list_gallery_url' => $this->security->xss_clean(secure_input($_POST['subpage_url'][$i])),                        'list_gallery_active_status'=>0,                      'list_gallery_order'=>($i+1),                      'list_gallery_create_date'=>$today,                      'list_gallery_create_by'=>$_SESSION['admin_data']['user_id'],                      'list_gallery_update_date'=>'',                      'list_gallery_update_by'=>''                  );              }         $this->Model_list_gallery->insertListCategory($data);         $this->data['errors'] = $this->error;         $this->data['success'] = $this->success;        //$this->generateCategory();        redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/listVideo/'.$gallery_id);    }            function editListVideo(){            $list_gallery_id = $this->input->post('primary_key');            $list_gallery_title = $this->input->post('title');             $list_gallery_image = str_replace(BASE_URL,"",$this->input->post('imgurl'));            $list_gallery_url = str_replace(BASE_URL,"",$this->input->post('vidurl'));            $list_gallery_status=$this->input->post('status');             $resize =$this->input->post('imgurl');            $thumbnail=$this->resizing($resize);            $list_gallery_order = $this->input->post('order');            if ($_SESSION['admin_data']['user_level_id'] == 1){                    $list_gallery_status = $list_gallery_status;                } else {                     $list_gallery_status = 0;                }            $this->Model_list_gallery->editListCategory($list_gallery_title,$list_gallery_image,$list_gallery_url,$list_gallery_order,$list_gallery_status,$list_gallery_id);            //$this->generateCategory();                       redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListVideo/'.$_SESSION['gallery_id']);    }           function activeListVideo($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListVideo/'.$_SESSION['gallery_id']);			exit();		}			//extract privilege		$this->data["approve"] = $this->privilege[5];				if($this->data["approve"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsContent = $this->Model_list_gallery->getListCategoryBy($id); 		$title = $rsContent[0]['list_gallery_title'];		$active_status = abs($rsContent[0]['list_gallery_active_status']-1);		$active = $this->Model_list_gallery->activeListCategory($id);		//createRouteAlias(); //create route alias		if($active_status == 1){			$log_module = "Active ".$this->module;		} else {			$log_module = "Inactive ".$this->module;		}		$log_value = $id." | ".$title." | ".$active_status;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);		//$this->generateCategory();                redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListVideo/'.$_SESSION['gallery_id']);			}         function deleteListVideoBy($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListVideo/'.$_SESSION['gallery_id']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];		if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}       		$delete = $this->Model_list_gallery->deleteListCategoryby($id);		$log_module = "Delete ".$this->module;		$log_value = $id." | ".$title;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                //$this->generateCategory();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListVideo/'.$_SESSION['gallery_id']);	}                     function listFloor($gallery_id=NULL){                                $_SESSION['gallery_id'] = $gallery_id;                $admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$searchkey = "";		$searchby = "";		$where = "";		$orderBy = "";		$perpage = "";			$cond = " and a.gallery_type = 4 ORDER BY a.list_gallery_id ASC";		$ListCategory = $this->Model_list_gallery->getListCategory($gallery_id, $cond);////		print_r($ListCategory);//                die;		$this->data["ListCategory"] = $ListCategory;		//extract privilege		$this->data["list"] = $this->privilege[0];		$this->data["view"] = $this->privilege[1];		$this->data["add"] = $this->privilege[2];		$this->data["edit"] = $this->privilege[3];		$this->data["publish"] = $this->privilege[4];		$this->data["approve"] = $this->privilege[5];		$this->data["delete"] = $this->privilege[6];		$this->data["order"] = $this->privilege[7];		if($this->data["list"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$this->data['searchkey'] = $searchkey;		$this->data['searchby'] = $searchby;		$this->data['perpage'] = $perpage;		$this->load->view('backend/header',$this->data);		$this->load->view('backend/list_floor/list');	}              function insertFloor() {          $gallery_id = $_SESSION['gallery_id'];        $today= date("Y-m-d H:i:s");            $data = array();              for ($i = 0; $i < count($this->input->post('subpage_title')); $i++) {                 $resize=$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]));                 $thumbnail=$this->resizing($resize);                 $data[] = array(                      'gallery_id'=>$gallery_id,                      'gallery_type'=>$this->security->xss_clean(secure_input($_POST['gallery_type'])),                      'list_gallery_title' => $this->security->xss_clean(secure_input($_POST['subpage_title'][$i])),                      'list_gallery_image' =>  str_replace(BASE_URL,"",$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]))),                       'list_gallery_url' => '',                       'list_gallery_active_status'=>0,                      'list_gallery_order'=>($i+1),                      'list_gallery_create_date'=>$today,                      'list_gallery_create_by'=>$_SESSION['admin_data']['user_id'],                      'list_gallery_update_date'=>'',                      'list_gallery_update_by'=>''                  );              }         $this->Model_list_gallery->insertListCategory($data);         $this->data['errors'] = $this->error;         $this->data['success'] = $this->success;        //$this->generateCategory();        redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/listFloor/'.$gallery_id);    }            function editListFloor(){            $list_gallery_id = $this->input->post('primary_key');            $list_gallery_title = $this->input->post('title');             $list_gallery_image = str_replace(BASE_URL,"",$this->input->post('imgurl'));            $list_gallery_status=$this->input->post('status');             $list_gallery_url = '';            $resize =$this->input->post('imgurl');            $thumbnail=$this->resizing($resize);            $list_gallery_order = $this->input->post('order');            if ($_SESSION['admin_data']['user_level_id'] == 1){                    $list_gallery_status = $list_gallery_status;                } else {                     $list_gallery_status = 0;                }            $this->Model_list_gallery->editListCategory($list_gallery_title,$list_gallery_image,$list_gallery_url,$list_gallery_order,$list_gallery_status,$list_gallery_id);            //$this->generateCategory();                       redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListFloor/'.$_SESSION['gallery_id']);    }           function activeListFloor($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListFloor/'.$_SESSION['gallery_id']);			exit();		}			//extract privilege		$this->data["approve"] = $this->privilege[5];				if($this->data["approve"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsContent = $this->Model_list_gallery->getListCategoryBy($id); 		$title = $rsContent[0]['list_gallery_title'];		$active_status = abs($rsContent[0]['list_gallery_active_status']-1);		$active = $this->Model_list_gallery->activeListCategory($id);		//createRouteAlias(); //create route alias		if($active_status == 1){			$log_module = "Active ".$this->module;		} else {			$log_module = "Inactive ".$this->module;		}		$log_value = $id." | ".$title." | ".$active_status;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);		//$this->generateCategory();                redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListFloor/'.$_SESSION['gallery_id']);			}         function deleteListFloorBy($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListFloor/'.$_SESSION['gallery_id']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];		if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}       		$delete = $this->Model_list_gallery->deleteListCategoryby($id);		$log_module = "Delete ".$this->module;		$log_value = $id." | ".$title;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                //$this->generateCategory();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListFloor/'.$_SESSION['gallery_id']);	}                     public function resizing($resize) {        $imageurl = str_replace(BASE_URL,PATH_PROJECT,$resize);        $image_name = end((explode('/', $resize)));       // echo PATH_PROJECT.$image_name;                $config['image_library'] = 'gd2';        $config['source_image'] = $imageurl;        $config['new_image'] = PATH_ASSETS.'/file_upload/thumbs/'.$image_name;                $config['create_thumb'] = FALSE;        $config['maintain_ratio'] = FALSE;        $config['width']         = 350;        $config['height']       = 300;        $config['x_axis']         = 150;        $config['y_axis']       = 150;        $this->load->library('image_lib', $config);        $this->image_lib->resize();        //$this->image_lib->crop();           }    }