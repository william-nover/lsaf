<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Home_content extends CI_Controller {	public $arrMenu = array();	public $data;	public $privilege = array();	public $section = 3; //get module group id from database	public $module_id = 37; //get module id from database	public $alias_category = "Home_content";	public $module = "Home_content";		public function __construct()	{		parent::__construct();                session_start();		if(empty($_SESSION['admin_data'])){			session_destroy();			redirect(BASE_URL_BACKEND."/signin");			exit();		}				$this->load->model(array('backend/Model_alias', 'backend/Model_language','backend/Model_logcms'));		$this->load->helper(array('funcglobal','menu','accessprivilege','alias'));				//get menu from helper menu		$this->arrMenu = menu();		$this->data = array();                $this->data['ListMenu'] = $this->arrMenu;                 $this->data['CountMenu'] = count($this->arrMenu);				//check privilege module		$this->privilege = accessprivilegeuserlevel($_SESSION['admin_data']['user_level_id'], $this->module_id);		$this->breadcrump = breadCrump($this->module_id);	}		public function index()	{		$this->add();	}				public function add(){		//extract privilege		$this->data["add"] = $this->privilege[2];		$this->data["approve"] = $this->privilege[5];		if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}				$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		                $pathOverview = PATH_ASSETS."/json/home_content.json";                if ($pathOverview){                        $arrOverview = json_decode(file_get_contents($pathOverview),TRUE);                        $this->data['content_title'] = $arrOverview['content_title'];                        $this->data['content_desc'] =  $arrOverview['content_desc'];                        $this->data['status'] =  $arrOverview['status'];                }               		$this->load->view('backend/header',$this->data);		$this->load->view('backend/home_content/list',$this->data);	}		public function doAdd(){		//extract privilege		$this->data["add"] = $this->privilege[2];                $this->data["approve"] = $this->privilege[5];				if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}				$tb = $_POST['tbSave'];		if (!$tb) {			redirect(BASE_URL_BACKEND."/home_content");			exit();		}				$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;				 $content_title = $this->security->xss_clean(secure_input($_POST['content_title']));		$content_desc = $this->security->xss_clean(secure_input($_POST['content_desc']));                $content_status =  secure_input_editor($_POST['content_status']);                if ($content_status == 1){                    $hstatus = 1;                                        }                 else {                    $hstatus = 0;                    }		if ($_SESSION['admin_data']['user_level_id'] == 1){                    $status = $hstatus;                } else {                     $status = 0;                }		$pesan = array();		// Validasi data		if ($content_title=="") {			$pesan[] = 'content title empty';		} else if ($content_desc=="") {			$pesan[] = 'Content title is empty';		}				if (! count($pesan)==0 ) {			foreach ($pesan as $indeks=>$pesan_tampil) {				$this->data['error'] = $pesan_tampil;								$this->data['content_title']=$content_title;				$this->data['content_desc']=$content_desc;				$this->data['status']=$status;									$this->load->view('backend/header',$this->data);				$this->load->view('backend/home_content/list',$this->data);			}		} else {                     $data = array(                                              'content_title' => $content_title,                                          'content_desc' => $content_desc,                                          'status' => $status                                           );                     print_r($data);                                  $ListHome_content= $data;                    createCache($ListHome_content,"home_content");                    $log_module = "Add ".$this->module;                    $log_value = "Overview | ".$content_title." | ".$content_desc." | ".$status;                    $insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                        if ($_SESSION['admin_data']['user_level_id'] != 1){                             $log ='Edit';                             $controller='Home Management - Section 1';                             $this->sendmailnotif($content_title,$controller,$log);                        }                     redirect(BASE_URL_BACKEND."/home_content/");                }		}	function sendmailnotif($content_title, $controller, $log)              {            //  $this->load->library('email');                         $subject = $log .'Banner Log';                        $message_email = "Some one has been edit, <br><br>";                        $message_email .= "Title : ".$content_title."<br>";                        $message_email .= "Page : ".$controller."<br>";			$header = "";			$header .= "Reply-To: ".BASE_URL." <noreply@".$_SERVER['SERVER_NAME'].">\r\n";			$header .= "Return-Path: ".BASE_URL." <noreply@".$_SERVER['SERVER_NAME'].">\r\n";			$header .= "From: ".BASE_URL." <noreply@".$_SERVER['SERVER_NAME'].">\r\n";			$header .= "Organization: ".$_SERVER['SERVER_NAME']." \r\n";			$header .= "X-Priority: 3\r\n";			$header .= "MIME-Version: 1.0\r\n";			$header .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";                                                     // Insert user record                      mail(MAIL_ADMINISTRATOR, $subject, $message_email, $header);                   // mail("hl.prbadolsa@gmail.com", $subject, $message_email, $header);              }			}