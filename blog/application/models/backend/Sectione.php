<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class Sectionc extends CI_Controller {	public $arrMenu = array();	public $data;	public $privilege = array();	public function __construct()	{		parent::__construct();                if( ! $_SESSION)                {                    session_start();                }		if(empty($_SESSION['admin_data'])){			session_destroy();			redirect(BASE_URL_BACKEND."/signin");			exit();		}		$this->load->model(array('backend/Model_menu_frontend','backend/Model_sectionc','backend/Model_sectionc_gallery','backend/Model_alias', 'backend/Model_language','backend/Model_logcms'));		$this->load->helper(array('funcglobal','menu','accessprivilege','alias'));		                $module_name=  $this->uri->segment(2);                $getmodule = $this->Model_sectionc->getModule($module_name);                foreach ($getmodule as $gm) {                 $this->module_id = $gm->module_id;                 $this->section = $gm->module_group_id;                 $_SESSION['module_id']=$this->module_id;                }		//get menu from helper menu		//get menu from helper menu		$this->arrMenu = menu();		$this->data = array();                $this->data['ListMenu'] = $this->arrMenu;                $this->data['CountMenu'] = count($this->arrMenu);		$this->data['controller'] = $module_name;               		//check privilege module		$this->privilege = accessprivilegeuserlevel($_SESSION['admin_data']['user_level_id'], $_SESSION['module_id']);		$this->breadcrump = breadCrump($_SESSION['module_id']);	}	public function index()	{		$this->view();	}		function view(){		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $_SESSION['module_id'];		$this->data['breadcrump'] = $this->breadcrump;		$searchkey = "";		$searchby = "";                             $condp = "order BY a.sectionc_id";                $ListSectionc = $this->Model_sectionc->getListSectionc($condp);			$this->data["ListSectionc"] = $ListSectionc;		//extract privilege		$this->data["list"] = $this->privilege[0];		$this->data["view"] = $this->privilege[1];		$this->data["add"] = $this->privilege[2];		$this->data["edit"] = $this->privilege[3];		$this->data["publish"] = $this->privilege[4];		$this->data["approve"] = $this->privilege[5];		$this->data["delete"] = $this->privilege[6];		$this->data["order"] = $this->privilege[7];		if($this->data["list"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}				$this->data['searchkey'] = $searchkey;		$this->data['searchby'] = $searchby;				$this->load->view('backend/header',$this->data);		$this->load->view('backend/Sectionc/list');	}         function add(){		//extract privilege		$this->data["add"] = $this->privilege[2];		if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		                              		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;               		$this->load->view('backend/header',$this->data);		$this->load->view('backend/Sectionc/add',$this->data);	}      	public function doAdd(){		//extract privilege		$this->data["add"] = $this->privilege[2];		if($this->data["add"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$tb = $_POST['tbSave'];		if (!$tb) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$sectionc_title = $this->security->xss_clean(secure_input($_POST['sectionctitle']));                 $sectionc_imageurl = $this->security->xss_clean(secure_input($_POST['sectioncimageurl']));		$sectionc_desc = $this->security->xss_clean(secure_input($_POST['sectioncdesc']));                $sectionc_urla = $this->security->xss_clean(secure_input($_POST['sectioncurla']));                 $sectionc_urlb = $this->security->xss_clean(secure_input($_POST['sectioncurlb']));                 $sectionc_urlc = $this->security->xss_clean(secure_input($_POST['sectioncurlc'])); 		$pesan = array();		// Validasi data		if ($sectionc_title=="") {			$pesan[] = 'Sectionc Page Title is empty';		} 			if (! count($pesan)==0 ) {			foreach ($pesan as $indeks=>$pesan_tampil) {				$this->data['error'] = $pesan_tampil;								$this->data['sectionctitle']=$sectionc_title;                                $this->data['sectioncdesc']=$sectionc_desc;                                $this->data['sectioncimageurl']=$sectionc_imageurl;                                $this->data['sectioncurla']=$sectionc_urla;                                $this->data['sectioncurla']=$sectionc_urlb;                                $this->data['sectioncurla']=$sectionc_urlc;													$this->load->view('backend/header',$this->data);				$this->load->view('backend/Sectionc/add',$this->data);			}		} else {			$cekSectionc = $this->Model_sectionc->checkSectionc($sectionc_title);			$countSectionc = count($cekSectionc);						if ($countSectionc > 0 ) {				$this->data['error']='Sectionc Title '.$sectionc_title.' already exist';				$this->data['sectionc_title']=$sectionc_title;							$this->load->view('backend/header',$this->data);				$this->load->view('backend/Sectionc/add',$this->data);			} else {				$sectionc_imageurl = str_replace(BASE_URL,"",$sectionc_imageurl);				$sectionc_id = $this->Model_sectionc->insertSectionc($sectionc_title,$sectionc_imageurl,$sectionc_desc,$sectionc_urla,$sectionc_urlb,$sectionc_urlc);                                $today= date("Y-m-d H:i:s");                                $data = array();                                  for ($i = 0; $i < count($this->input->post('subpage_title')); $i++) {                                      $checkfile = $this->Model_sectionc_gallery->checkGallery($this->security->xss_clean(secure_input($_POST['sectionc_gallery_title'][$i])), $sectionc_id);                                      if (empty($checkfile)){                                        $resize=$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]));                                        $thumbnail=$this->resizing($resize);                                         $data[] = array(                                          'sectionc_id'=>$sectionc_id,                                          'sectionc_gallery_title' => $this->security->xss_clean(secure_input($_POST['subpage_title'][$i])),                                          'sectionc_gallery_image' => str_replace(BASE_URL,"",$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]))),                                           'sectionc_gallery_order'=>1,                                          'sectionc_gallery_active_status'=>1,                                          'sectionc_gallery_create_date'=>$today,                                          'sectionc_gallery_create_by'=>$_SESSION['admin_data']['user_id'],                                          'sectionc_gallery_update_date'=>'',                                          'sectionc_gallery_update_by'=>''                                           );                                                                                   }                                  }                                                                        $this->Model_sectionc_gallery->insertGallery($data);					$log_module = "Add ".$this->module;					$log_value = $sectionc_id." | ".$sectionc_title;					$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);									redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);				}			}		}   	function active($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["approve"] = $this->privilege[5];		if($this->data["approve"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsSectionc = $this->Model_sectionc->getSectionc($id); 		$title = $rsSectionc[0]['sectionc_title'];		$active_status = abs($rsSectionc[0]['sectionc_active_status']-1);		$active = $this->Model_sectionc->activeSectionc($id);		createRouteAlias(); //create route alias		if($active_status == 1){			$log_module = "Active ".$this->module;		} else {			$log_module = "Inactive ".$this->module;		}		$log_value = $id." | ".$title." | ".$active_status;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                                $this->generateSectionc();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);	}         function delete($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];				if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsSectionc = $this->Model_sectionc->getSectionc($id); 		$title = $rsSectionc[0]['sectionc_title'];                                      if($page_type == 2){                $this->deleteSectionc($id);                }                $delete = $this->Model_sectionc->deleteSectionc($id);		$log_module = "Delete ".$this->module;		$log_value = $id." | ".$title;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                                $this->generateSectionc();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);	}              public function deleteSectionc($id){            if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];		if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}                $where = "";                $orderBy = "ORDER BY a.sectionc_id DESC";				$cond 			= $where." ".$orderBy;                $ListSectionc = $this->Model_sectionc->getListSectionc($id, $cond);                foreach($ListSectionc as $sectionc){                          $image_path = './assets/images/'.$sectionc['sectionc_image'];                         $image_resize = './assets/images/resized/'.$sectionc['sectionc_image'];                                 $image_thumb = './assets/images/thumb/'.$sectionc['sectionc_image'];                         if($sectionc['sectionc_image'] != 'default_icon.png'){                        unlink($image_path);                        unlink($image_resize);                        unlink($image_thumb);                           }                             $this->Model_sectionc->deleteSectionc($sectionc['sectionc_id']);                }                           }      public function edit($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["edit"] = $this->privilege[3];		if($this->data["edit"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;			$rsSectionc = $this->Model_sectionc->getSectionc($id);                 // mengambil database dari model untuk dikirim ke view		                $countSectionc = count($rsSectionc);		$this->data['rsSectionc'] = $rsSectionc;		$this->data['countSectionc'] = $countSectionc;		$this->load->view('backend/header',$this->data);		$this->load->view('backend/Sectionc/edit',$this->data);	}		public function doEdit($id){		$tb = $_POST['tbEdit'];		if (!$tb OR $id == '') {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}		//extract privilege		$this->data["edit"] = $this->privilege[3];		if($this->data["edit"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$rsSectionc = $this->Model_sectionc->getSectionc($id);  // mengambil database dari model untuk dikirim ke view		$countSectionc = count($rsSectionc);		$this->data['rsSectionc'] = $rsSectionc;		$this->data['countSectionc'] = $countSectionc;		$sectionc_title = $this->security->xss_clean(secure_input($_POST['sectionctitle']));                $sectionc_titleOld = $this->security->xss_clean(secure_input($_POST['sectionc_titleOld']));                $sectionc_imageurl = $this->security->xss_clean(secure_input($_POST['sectioncimageurl']));                $sectionc_desc = $this->security->xss_clean(secure_input($_POST['sectioncdesc']));                $sectionc_urla = $this->security->xss_clean(secure_input($_POST['sectioncurla']));                 $sectionc_urlb = $this->security->xss_clean(secure_input($_POST['sectioncurlb']));                 $sectionc_urlc = $this->security->xss_clean(secure_input($_POST['sectioncurlc']));				$pesan = array();		// Validasi data		if ($sectionc_title=="") {			$pesan[] = 'Sectionc Title is empty';		} 		if (! count($pesan)==0 ) {			foreach ($pesan as $indeks=>$pesan_tampil) {				$this->data['error'] = $pesan_tampil;				$this->load->view('backend/header',$this->data);				$this->load->view('backend/Sectionc/edit',$this->data);			}		} else {			$cekSectionc = $this->Model_sectionc->checkSectionc($sectionc_title);			$countSectionc = count($cekSectionc);			if($sectionc_title == $sectionc_titleOld){				$countSectionc = 0;			}			if ($countSectionc > 0 ) {				$this->data['error']='Sectionc Title '.$sectionc_title.' already exist';				$this->load->view('backend/header',$this->data);				$this->load->view('backend/Sectionc/edit',$this->data);			} else {				$sectionc_imageurl = str_replace(BASE_URL,"",$sectionc_imageurl);				$update = $this->Model_sectionc->updateSectionc($id,$sectionc_title,$sectionc_imageurl,$sectionc_desc,$sectionc_urla,$sectionc_urlb,$sectionc_urlc);				                                $log_module = "Edit ".$this->module;                                $log_value = $id." | ".$sectionc_title;                                $insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                                                                $this->generateSectionc();                                                                                        redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			}			}			}                 function doOrder(){		$order = $this->security->xss_clean($_POST['order']);		if($order == ""){			redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);			exit();		}         foreach($order as $id => $ordervalue){			$this->Model_sectionc->updateOrderSectionc($id,$ordervalue);                        echo $ordervalue;		}                $this->generateSectionc();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller']);	}               function listGallery($sectionc_id=NULL){                                $_SESSION['sectionc_id'] = $sectionc_id;                $admin_data = $_SESSION['admin_data'];		$this->data['admin_data'] = $admin_data;		$this->data['section'] = $this->section; 		$this->data['modul_id'] = $this->module_id;		$this->data['breadcrump'] = $this->breadcrump;		$searchkey = "";		$searchby = "";		$where = "";		$orderBy = "";		$perpage = "";			$cond = "ORDER BY a.sectionc_gallery_id ASC";		$ListGallery = $this->Model_sectionc_gallery->getGallery($sectionc_id, $cond);////		print_r($ListSectionc);//                die;		$this->data["ListGallery"] = $ListGallery;		//extract privilege		$this->data["list"] = $this->privilege[0];		$this->data["view"] = $this->privilege[1];		$this->data["add"] = $this->privilege[2];		$this->data["edit"] = $this->privilege[3];		$this->data["publish"] = $this->privilege[4];		$this->data["approve"] = $this->privilege[5];		$this->data["delete"] = $this->privilege[6];		$this->data["order"] = $this->privilege[7];		if($this->data["list"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$this->load->view('backend/header',$this->data);		$this->load->view('backend/sectionc_gallery/list');	}              function insertGallery() {          $sectionc_id = $_SESSION['sectionc_id'];        $today= date("Y-m-d H:i:s");            $data = array();              for ($i = 0; $i < count($this->input->post('subpage_title')); $i++) {                 $resize=$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]));                 $thumbnail=$this->resizing($resize);                 $data[] = array(                      'sectionc_id'=>$sectionc_id,                      'sectionc_gallery_title' => $this->security->xss_clean(secure_input($_POST['subpage_title'][$i])),                      'sectionc_gallery_image' =>  str_replace(BASE_URL,"",$this->security->xss_clean(secure_input($_POST['subpage_image'][$i]))),                       'sectionc_gallery_active_status'=>0,                      'sectionc_gallery_order'=>($i+1),                      'sectionc_gallery_create_date'=>$today,                      'sectionc_gallery_create_by'=>$_SESSION['admin_data']['user_id'],                      'sectionc_gallery_update_date'=>'',                      'sectionc_gallery_update_by'=>''                  );              }         $this->Model_sectionc_gallery->insertGallery($data);         $this->data['errors'] = $this->error;         $this->data['success'] = $this->success;        $this->generateSectionc();        redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/listGallery/'.$sectionc_id);    }            function editGallery(){            $sectionc_gallery_id = $this->input->post('primary_key');            $sectionc_gallery_title = $this->input->post('title');             $sectionc_gallery_image = str_replace(BASE_URL,"",$this->input->post('imgurl'));            $sectionc_gallery_status=$this->input->post('status');             $resize =$this->input->post('imgurl');            $thumbnail=$this->resizing($resize);            $sectionc_gallery_order = $this->input->post('order');            if ($_SESSION['admin_data']['user_level_id'] == 1){                    $sectionc_gallery_status = $sectionc_gallery_status;                } else {                     $sectionc_gallery_status = 0;                }            $this->Model_sectionc_gallery->editGallery($sectionc_gallery_title,$sectionc_gallery_image,$sectionc_gallery_order,$sectionc_gallery_status,$sectionc_gallery_id);            $this->generateSectionc();                       redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/listGallery/'.$_SESSION['sectionc_id']);    }           function activeGallery($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListGallery/'.$_SESSION['sectionc_id']);			exit();		}			//extract privilege		$this->data["approve"] = $this->privilege[5];				if($this->data["approve"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}		$rsContent = $this->Model_sectionc_gallery->getGalleryBy($id); 		$title = $rsContent[0]['sectionc_gallery_title'];		$active_status = abs($rsContent[0]['sectionc_gallery_active_status']-1);		$active = $this->Model_sectionc_gallery->activeGallery($id);		//createRouteAlias(); //create route alias		if($active_status == 1){			$log_module = "Active ".$this->module;		} else {			$log_module = "Inactive ".$this->module;		}		$log_value = $id." | ".$title." | ".$active_status;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);		$this->generateSectionc();                redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListGallery/'.$_SESSION['sectionc_id']);			}         function deleteGalleryBy($id){		if (empty($id)) {			redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListGallery/'.$_SESSION['sectionc_id']);			exit();		}		//extract privilege		$this->data["delete"] = $this->privilege[6];		if($this->data["delete"] == 0){			echo "<script>alert('Can\'t Access Module');window.location.href='".BASE_URL_BACKEND."/home';</script>";			die;		}       		$delete = $this->Model_sectionc_gallery->deleteGalleryby($id);		$log_module = "Delete ".$this->module;		$log_value = $id." | ".$title;		$insertlog = $this->Model_logcms->insertLogCMS($log_module,$log_value);                $this->generateSectionc();		redirect(BASE_URL_BACKEND.'/'.$this->data['controller'].'/ListGallery/'.$_SESSION['sectionc_id']);	}       function generateSectionc(){                $ListSectionc		= $this->Model_sectionc_gallery->generateSectionc();		$countSectionc		= count($ListSectionc);		//createCacheBanner($rsBanner,"bannerhome");               createCache($ListSectionc,"sectionc");        }       public function resizing($resize) {        $imageurl = str_replace(BASE_URL,PATH_PROJECT,$resize);        $image_name = end((explode('/', $resize)));       // echo PATH_PROJECT.$image_name;                $config['image_library'] = 'gd2';        $config['source_image'] = $imageurl;        $config['new_image'] = PATH_ASSETS.'/file_upload/thumbs/'.$image_name;                $config['create_thumb'] = FALSE;        $config['maintain_ratio'] = FALSE;        $config['width']         = 350;        $config['height']       = 300;        $config['x_axis']         = 150;        $config['y_axis']       = 150;        $this->load->library('image_lib', $config);        $this->image_lib->resize();        //$this->image_lib->crop();           }    }